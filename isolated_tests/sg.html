<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aperture</title>
  <style>
    body{
      margin:0;
      height:100vh;
      display:grid;
      place-items:center;
      background:#fff;
    }

    /* ===== CONFIG ====== */
    #aperture{
      width:320px;
      height:320px;
      --color:#0b0b18;   
      --bg:#ffffff;       
      --duration:2400ms;  
      --blades:6;           
      --spinTurns:1.45;     
    }

    .blade{ fill: var(--color); }
    .bg{ fill: var(--bg); }
  </style>
</head>

<body>

<svg id="aperture" viewBox="-120 -120 240 240" xmlns="http://www.w3.org/2000/svg" aria-label="aperture">
  <rect class="bg" x="-120" y="-120" width="240" height="240"/>

  <defs>
    <mask id="clipInner">
      <rect x="-120" y="-120" width="240" height="240" fill="black"/>
      <circle r="100" fill="white"/>
    </mask>
  </defs>

  <g mask="url(#clipInner)">
    <g id="apertureGroup"></g>
    <circle id="hole" class="bg" cx="0" cy="0" r="10"></circle>
  </g>
</svg>

<script>
(function(){
  const svg = document.getElementById('aperture');
  const g = svg.querySelector('#apertureGroup');
  const hole = svg.querySelector('#hole');

  const css = getComputedStyle(svg);
  const N = Math.max(3, parseInt(css.getPropertyValue('--blades')) || 6);
  const duration = parseTime(css.getPropertyValue('--duration')) || 2400;
  const spinTurns = parseFloat(css.getPropertyValue('--spinTurns')) || 0.75;

  const R = 100; 

const S = [
  { rIn:10, w:0.995, twist:0.95, shear:0.62 },

  { rIn:14, w:0.985, twist:0.92, shear:0.60 },
  { rIn:18, w:0.975, twist:0.89, shear:0.58 },
  { rIn:22, w:0.965, twist:0.86, shear:0.56 },
  { rIn:26, w:0.955, twist:0.83, shear:0.54 },
  { rIn:30, w:0.945, twist:0.80, shear:0.53 },

  { rIn:34, w:0.930, twist:0.78, shear:0.52 },

  { rIn:38, w:0.915, twist:0.74, shear:0.50 },
  { rIn:42, w:0.900, twist:0.70, shear:0.48 },
  { rIn:46, w:0.885, twist:0.66, shear:0.46 },
  { rIn:50, w:0.870, twist:0.62, shear:0.44 },

  { rIn:54, w:0.860, twist:0.58, shear:0.42 },

  { rIn:58, w:0.845, twist:0.54, shear:0.40 },
  { rIn:62, w:0.830, twist:0.50, shear:0.38 },
  { rIn:66, w:0.815, twist:0.46, shear:0.36 },
  { rIn:70, w:0.800, twist:0.42, shear:0.34 },
  { rIn:74, w:0.785, twist:0.38, shear:0.30 },

  { rIn:78, w:0.720, twist:0.30, shear:0.22 },
];


  const blades = [];
  for(let i=0;i<N;i++){
    const p = document.createElementNS('http://www.w3.org/2000/svg','path');
    p.setAttribute('class','blade');
    g.appendChild(p);
    blades.push(p);
  }

  const ease = x => x < 0.5 ? 4*x*x*x : 1 - Math.pow(-2*x+2,3)/2;
  const lerp = (a,b,t)=>a+(b-a)*t;

  function pingPong(u){ return u<=0.5 ? u*2 : 1-(u-0.5)*2; }

function sampleN(t){
  const a = Math.min(0.999999, Math.max(0, t));
  const max = S.length - 1;
  const seg = Math.min(max - 1, Math.floor(a * max));
  const local = a * max - seg;
  const e = ease(local);
  const A = S[seg], B = S[seg + 1];
  return {
    rIn:   lerp(A.rIn,   B.rIn,   e),
    w:     lerp(A.w,     B.w,     e),
    twist: lerp(A.twist, B.twist, e),
    shear: lerp(A.shear, B.shear, e),
  };
}

  function polar(r,a){ return {x:r*Math.cos(a), y:r*Math.sin(a)}; }

  function bladePath(i,P){
    const step = 2*Math.PI/N;
    const base = i*step;

    const w = step * P.w;
    const twist = step * P.twist;
    const shear = step * P.shear;

    const rOut = R;
    const rIn = P.rIn;

    const a1 = base - w/2 + twist;
    const a2 = base + w/2 + twist;
    const b1 = a1 + shear;
    const b2 = a2 + shear;

    const P1 = polar(rOut, a1);
    const P2 = polar(rOut, a2);
    const P3 = polar(rIn,  b2);
    const P4 = polar(rIn,  b1);

    return [
      `M ${P1.x.toFixed(3)} ${P1.y.toFixed(3)}`,
      `A ${rOut.toFixed(3)} ${rOut.toFixed(3)} 0 0 1 ${P2.x.toFixed(3)} ${P2.y.toFixed(3)}`,
      `L ${P3.x.toFixed(3)} ${P3.y.toFixed(3)}`,
      `A ${rIn.toFixed(3)} ${rIn.toFixed(3)} 0 0 0 ${P4.x.toFixed(3)} ${P4.y.toFixed(3)}`,
      `Z`
    ].join(' ');
  }

  const t0 = performance.now();
  function frame(now){
    const u = ((now - t0) % duration) / duration; 
    const t = ease(pingPong(u));                

const P = sampleN(t);

    const rot = u * 360 * spinTurns;
    g.setAttribute('transform', `rotate(${rot.toFixed(3)})`);

    for(let i=0;i<N;i++){
      blades[i].setAttribute('d', bladePath(i, P));
    }

    hole.setAttribute('r', (P.rIn - 2).toFixed(3));

    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);

  function parseTime(v){
    v = (v || '').trim();
    if(!v) return null;
    if(v.endsWith('ms')) return parseFloat(v);
    if(v.endsWith('s'))  return parseFloat(v)*1000;
    const n = parseFloat(v);
    return Number.isFinite(n) ? n : null;
  }
})();
</script>

</body>
</html>
